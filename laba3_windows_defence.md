## 1. Физическая модель магнитного диска. Какие компоненты компьютера используют это.   
На физическом уровне проводится через контроллер. именно он рассказывает о информации на диске, не зависит от оперативной системы.   
## 2. Логическая модель диска FAT.   

Адресное пространство диска - набор секторов с единой логической нумерацией, небольшая часть этих секторов выделяется для хранения служебной информации и называется системной областью диска (метаданными). Остальные сектора хранят данные.   

С логической моделью диска работает ОС  

**Кластер** - единица размещения файлов в дисковой памяти.   
Почему оно полезно?   
- уменьшаются дальние перемещения головок чтения и увеличивается скорость выполнения операций чтения/записи  
- появляется возможность структурировать (отделять файлы системы от файлов пользователя)  
- на одном диске можно ставить много разных линуксов  
- на одном диске можно хранить информацию в разных файловых системах, ну или пофиг, с разным размером кластера.    
  
FAT - система.   
1. Загрузочная запись  
2. Таблица размещения файлов (2 копии)  
3. Корневой каталог   
4. Кластеры данных (файлики)  

Таблица размещений содержит инфу о размещении файлов в области. Занимает сектора, начиная с первого. Для безопасности всегда хранится 2 копии FAT, которые обновляются одновременно.   

Корневой каталог - каталог диска, который занимает сектора, следующие за FAT. 
В чем прикол FAT?  
+ Фиксированное число элементов  
+ Размещение в системной области корневого каталога   
## 3. Разделы диска: типы и максимальное количество.  
Главная загрузочная запись (MBR) - файлик со структурой данных и программой, которая загружает в ОЗУ загрузчик ОС. располагается в первом секторе. физический адрес 0-0-1.   
  
в MBR расположена таблица разделения на разделы, 4 записи по 16 байтов.   
Каждая запись хранит информацию по одну первичному разделу.   
Логические разделы расширяют ограничение в 4 диска.   
  
Для каждого раздела: Z:  
Первый сектор - описание логического раздела  
Второй - описание расширенного раздела  
другие не используются   
  
С последнего расширенного в ячейке идет ссылка на следующий логический раздел.   
  
В последнее время находит свое место алгоритм GPT - 128 разделов, каждый из которых первичный. Необходимо иметь UEFI вместо BIOS.  
## 4. Каким образом поддерживается древовидная многоуровневая система каталогов в Windows?  
Единица дисковой памяти - кластер с размером, кратным размеру сектора, вплоть до 64 Кбайт. Все кластеры имеюбт сквозную нумерацию, причем допустимый номер - 2 (1 занят системный MRP). Файлы могут храниться в несмежных кластерах, частях диска.   
  
Файл Windows - поименованная совокупность информации в ВЗУ. В виде файлов хранятся программы и данные.   
  
Каталог - файл специального формата, предназначенный для хранения метаданных о зареганных в этих файлах и подкаталогах (имя, расширения, дата и прочие атрибуты).  
  
В Windows древовидная многоуровневая система каталогов поддерживается с помощью файловой системы NTFS (New Technology File System). NTFS предоставляет механизм для создания и организации каталогов и файлов в иерархическую структуру.  
  
Каждый диск, раздел или том в Windows имеет корневой каталог, обозначаемый символом "", который является самым верхним уровнем иерархии файловой системы. Из корневого каталога могут быть созданы подкаталоги, которые в свою очередь могут содержать другие подкаталоги и файлы. Таким образом, образуется древовидная структура каталогов.  
## 5. Структура таблицы FAT.  
FAT - система.   
1. Загрузочная запись  
2. Таблица размещения файлов (2 копии)  
3. Корневой каталог   
4. Кластеры данных (файлики)  
## 6. Структура каталогов FAT? В чем отличие корневого и прочих каталогов?   
Корневой каталог диска  
Записи корневого каталога - 32 Байт.   
Если файл не имеет расширения, то хранятся пробелы.  
 Дата и время - четырехбайтное значение  
 Номер начального кластера - точка входа в FAT, и дисковый адрес файла.   
  
 Байт атрибутов файла задает его статус, если он равен 8, то метка тома хранится в полях имени и расширения файла элемента корневого каталога.   
 Если это подкаталог - то используются все поля элемента каталога, при этом размер файла имеет нулевое значение.   
   
 **Каталог нижнего уровня**   
 Все подкаталоги имеют структуру, похожую на корневой каталог, только не имеют фиксированного размера и дискового адреса, короче хранятся как обычные файлы.   
  
 Для того, чтобы можно было перемещаться по дереву, есть адреса . - эта папка
 .. папка вверх   
 если поле содержит нуль, то это корневая папка.   
## 7. Какие действия выполняются при удалении файла в FAT и NTFS?  
**FAT**  
 Удаление файлов   
 При удалении   
 - Обнуляются все элементы, выделенные для описания этого файла.   
 - Вресто первого символа в поле имени прописывается символ x  
  
 Остальные характеристики не меняются, на них со временем записываются новые значения.   

 Полное восстановление возможно, если  
 - не перезаписано  
 - имеется доступ к каталогу  
 - кластеры, ранее занимаемые файлом, не выделены другим файлам.   
 - удаленный файл был не фрагментирован  
  
**NTFS**  
1. Маркировка файла как удаленного: Когда пользователь удаляет файл, операционная система помечает его метаданные в файловой таблице NTFS (MFT) как "удаленные". Это означает, что файл больше не отображается в файловом обозревателе и становится недоступным для обычных операций чтения и записи.  
      
2. Освобождение пространства: Фактическое освобождение занимаемого файлом дискового пространства не происходит немедленно. Вместо этого, NTFS помечает блоки данных, ранее занимаемые файлом, как доступные для повторного использования. Это позволяет оптимизировать производительность, избегая физического удаления данных сразу же после удаления файла.  
      
3. Удаление метаданных: После маркировки файла как удаленного, NTFS может начать перезаписывать метаданные, связанные с файлом в MFT. Это включает информацию о имени файла, его размере, атрибутах, временных метках и других свойствах. Перезапись метаданных обычно происходит по мере необходимости, когда новые файлы создаются и занимают место в MFT.  
      
4. Физическое удаление данных: Планировщик NTFS может фоново выполнять операции по физическому удалению данных удаленных файлов с дискового пространства. В процессе работы планировщик может освобождать блоки данных, ранее занимаемые файлом, для последующего использования другими файлами.  
    
  
Важно отметить, что после удаления файла в NTFS возможно восстановление данных с помощью специализированных инструментов, пока соответствующие блоки данных не были перезаписаны другими файлами. Для более надежного удаления файлов с диска можно использовать специальные программы или функции шифрования и очистки данных.  
## 8. Поясните действия файловой системы FAT при поиске файла по имени:   
В файловой системе FAT (File Allocation Table) в Windows, поиск файла по имени выполняется следующим образом:  
  
1. Чтение корневого каталога: FAT использует специально выделенную область на диске, называемую корневым каталогом, для хранения информации о файлах и подкаталогах в корневом уровне директорий. При поиске файла по имени, операционная система считывает содержимое корневого каталога в память.  
      
2. Проход по записям каталога: Корневой каталог состоит из фиксированного числа записей, каждая из которых представляет отдельный файл или подкаталог. Операционная система последовательно просматривает эти записи, сравнивая имена файлов с искомым именем.  
      
3. Сравнение имени файла: При каждом шаге обхода записей каталога, операционная система сравнивает имя текущей записи с искомым именем файла. Если найдено соответствие, то файл считается найденным.  
      
4. Индексирование файлов: В FAT файлы не индексируются по имени, поэтому операционная система должна просмотреть все записи в корневом каталоге или в подкаталогах, чтобы найти файл по имени. Это означает, что время поиска файла может зависеть от количества файлов в директории и иерархии каталогов.  
      

Важно отметить, что файловая система FAT не обладает эффективными механизмами индексации и быстрого поиска файлов, особенно при работе с большими объемами данных. Поэтому, на дисках с большим количеством файлов или большой глубиной иерархии каталогов, поиск файлов может занимать значительное время.  
  
## 9. Механизм выделения дисковой памяти FAT при записи нового файла.  
При записи нового файла в файловой системе FAT (File Allocation Table) выполняются следующие шаги:  
  
1. Выбор свободных кластеров: Когда пользователь создает новый файл, операционная система ищет свободные кластеры на диске для размещения данных файла. Кластер - это минимальная единица выделения памяти в файловой системе FAT.  
      
2. Обновление FAT: После выбора свободных кластеров, операционная система обновляет таблицу FAT, чтобы указать, какие кластеры заняты новым файлом. Запись в FAT содержит информацию о том, как упорядочены и связаны кластеры в файле.  
      
3. Запись данных: После обновления таблицы FAT, операционная система начинает записывать данные нового файла в выбранные кластеры. Данные могут быть записаны непосредственно в кластеры или в буфер в памяти для оптимизации производительности.  
      
4. Обновление метаданных: Вместе с записью данных, операционная система также обновляет метаданные нового файла. Это может включать информацию о имени файла, его размере, атрибутах, временных метках и других свойствах. Метаданные хранятся в записи каталога, связанной с файлом.  
      
5. Обновление таблицы каталогов: Последний шаг - обновление таблицы каталогов, чтобы добавить новую запись для созданного файла. Таблица каталогов содержит информацию о файле, включая его имя и ссылку на соответствующую запись в FAT.  
      

Важно отметить, что выделение памяти в файловой системе FAT может приводить к фрагментации диска, поскольку файлы могут занимать несвязанные кластеры на диске. Фрагментация может негативно сказываться на производительности системы, поэтому иногда требуется выполнить операцию дефрагментации диска для упорядочивания данных и улучшения доступа к ним.  

## 10. Чем определяется число элементов каталога, выделяемых для хранения метаданных файла в файловой системе FAT?   
Количеством байтов, отведенных на нумерацию файлов.   
в классическом FAT 32 файла в одном каталоге   
но в последних версиях их до 512.   
## 11. Назовите основные различия файловых систем FAT и NTFS.  
Основные различия между файловыми системами FAT (File Allocation Table) и NTFS (New Technology File System) включают:  
  
1. **Структура**: FAT использует простую структуру с таблицей распределения файлов, которая содержит информацию о расположении файлов на диске. NTFS имеет более сложную иерархическую структуру, включающую файловые таблицы и журналы для повышения надежности и производительности.  
      
2. **Размер файлов и объемов**: В FAT32 (последняя версия FAT) максимальный размер файла ограничен 4 Гб, а максимальный размер раздела составляет 32 ТБ. В NTFS максимальный размер файла - 16 ТБ, а максимальный размер раздела - 256 ТБ.  
      
3. **Система безопасности**: NTFS поддерживает расширенные возможности безопасности, такие как контроль доступа на основе разрешений (ACL), шифрование файлов и аудит доступа к файлам. FAT не поддерживает эти функции безопасности.  
      
4. **Отказоустойчивость**: NTFS обладает более высоким уровнем отказоустойчивости благодаря своей журнализации. Журнал NTFS записывает все операции с файлами перед их выполнением, что позволяет восстановить данные в случае сбоя системы или отключения питания. FAT не имеет такого механизма восстановления.  
      
5. **Поддержка дополнительных функций**: NTFS поддерживает дополнительные функции, такие как расширенные атрибуты файлов, сжатие данных и ссылки на файлы (жесткие и символические). FAT не поддерживает эти функции.  
      

В целом, NTFS обладает более высокой производительностью, надежностью и безопасностью по сравнению с FAT, однако FAT все еще используется в некоторых устройствах и операционных системах, где требуются более простые структуры файловой системы.
## 12. Структура файла MFT.  
MFT (Master File Table) - это основная таблица файловой системы NTFS (New Technology File System), которая содержит информацию о каждом файле и каталоге на диске.  
  
Структура MFT состоит из записей, называемых MFT-записями. Каждый файл или каталог в NTFS имеет соответствующую MFT-запись, которая содержит следующую информацию:  
  
1. **Заголовок MFT-записи**: Содержит метаданные о MFT-записи, такие как размер, номер индекса MFT и атрибуты MFT-записи.  
      
2. **Атрибуты MFT-записи**: MFT-запись может содержать один или несколько атрибутов, которые описывают различные свойства файла или каталога, например, имя файла, размер, время создания и изменения, доступы, сжатие и шифрование данных.  
      
3. **Ссылки на другие MFT-записи**: NTFS использует ссылочную структуру для связывания файлов и каталогов друг с другом. MFT-запись может содержать ссылки на другие MFT-записи, чтобы установить отношения между ними, например, связь между каталогами и подкаталогами.  
      
4. **Данные файла или каталога**: MFT-запись также может содержать фактические данные файла или каталога, если их размер меньше или равен предопределенному размеру. В противном случае, для хранения данных используются дополнительные блоки на диске.  
      

Структура MFT позволяет файловой системе NTFS эффективно организовывать и управлять файлами и каталогами. Она обеспечивает быстрый доступ к информации о файлах и поддержку различных функций, таких как безопасность, сжатие данных и шифрование.  
## 13. Восстановление файлов в FAT и NTFS?  
FAT  
1. **Открытие диска:** Откройте диск, на котором находятся удаленные файлы, и получите доступ к его содержимому.  
2. **Чтение заголовка BPB:** Прочитайте заголовок BPB (BIOS Parameter Block) в начале диска для получения информации о разметке и параметрах файловой системы FAT32.  
3. **Чтение FAT таблицы:** FAT таблица хранит информацию о каждом кластере на диске и связях между ними. Прочитайте эту таблицу и сохраните ее в оперативной памяти для последующего использования.  
4. **Поиск удаленных файлов:** Проанализируйте FAT таблицу и найдите кластеры, которые ранее были заняты удаленными файлами. Удаленные файлы обычно помечены в FAT таблице как свободные или зарезервированные. Запомните эти кластеры для дальнейшего восстановления.  
5. **Сбор фрагментов файла:** Используя информацию о кластерах, занимаемых удаленным файлом, соберите все фрагменты файла в правильном порядке. Это может потребовать обхода FAT таблицы от начального кластера до последнего.  
6. **Восстановление данных:** Когда фрагменты файла собраны, прочитайте данные из этих кластеров и сохраните их в памяти или на другом диске.  
7. **Сохранение восстановленных файлов:** После успешного восстановления файла сохраните его в выбранном вами месте, предпочтительно на другом диске или разделе, чтобы избежать перезаписи данных.  
8. **Закрытие диска:** После завершения восстановления файлов закройте диск и завершите программу.  
NTFS  
-  **Открытие диска**: Откройте диск, с которого вы хотите восстановить файлы, и получите доступ к его содержимому.  
- **Чтение заголовка MBR**: Прочитайте заголовок MBR (Master Boot Record) в начале диска для получения информации о разделах на диске, включая раздел NTFS, с которого вы хотите восстановить файлы.  
- **Чтение заголовка раздела NTFS**: Считайте заголовок раздела NTFS из соответствующего раздела, чтобы получить информацию о разметке и параметрах файловой системы NTFS.
- **Чтение таблицы MFT**: Найдите таблицу MFT (Master File Table), которая содержит информацию о всех файлах и папках в разделе NTFS. Таблица MFT является основной структурой для восстановления файлов. Прочитайте эту таблицу и получите доступ к записям файлов и их метаданным.  
- **Анализ записей MFT**: Проанализируйте каждую запись MFT, чтобы определить, является ли файл удаленным или испорченным. Удаленные файлы обычно помечены в записях MFT, их данные могут быть перезаписаны другими файлами, но метаданные остаются. Испорченные файлы могут иметь поврежденные данные и метаданные.  
- **Восстановление удаленных файлов**: Если файл считается удаленным, вы можете попытаться восстановить его данные, сканируя диск на наличие фрагментов удаленного файла и объединяя эти фрагменты в полезные данные. Это может потребовать использования алгоритмов восстановления данных, таких как поиск по сигнатуре или анализ фрагментации.  
- **Восстановление испорченных файлов**: Для испорченных файлов можно попытаться восстановить целостность данных или использовать резервную копию MFT для восстановления метаданных.  
- **Сохранение восстановленных файлов**: После успешного восстановления файла сохраните его в выбранном вами месте, предпочтительно на другом диске или разделе, чтобы избежать перезаписи данных.  
- **Закрытие диска**: После завершения восстановления файлов закройте диск и завершите программу.
## 14. Резидентные и нерезидентные атрибуты записи MFT.  
**Резидентные атрибуты**: Резидентные атрибуты представляют собой данные, которые полностью содержатся в самой MFT-записи. Они хранятся непосредственно внутри MFT-записи и могут быть прочитаны без необходимости обращения к дополнительным блокам на диске. Некоторые типичные резидентные атрибуты включают имя файла, размер, время создания и изменения файла.  
  
**Нерезидентные атрибуты**: Нерезидентные атрибуты - это данные, которые не помещаются полностью внутри MFT-записи и требуют дополнительных блоков на диске для их хранения. Когда размер атрибута превышает фиксированный размер MFT-записи, он становится нерезидентным. Примеры нерезидентных атрибутов включают содержимое файла, атрибуты безопасности и индексные данные.  
  
В MFT-записи может быть несколько атрибутов, как резидентных, так и нерезидентных. Каждый атрибут имеет свой тип, размер и другие атрибуты, которые описывают его содержимое и местоположение на диске.  
  
В целом, использование резидентных и нерезидентных атрибутов в MFT-записях позволяет эффективно хранить информацию о файлах и каталогах в файловой системе NTFS. Резидентные атрибуты обеспечивают быстрый доступ к основным данным, тогда как нерезидентные атрибуты позволяют хранить большие объемы данных или специализированную информацию за пределами MFT-записи.  
## 15. Каким образом в NTFS увеличена скорость доступа к файлам по сравнению с FAT?  
1. **Использование индексированных структур**: NTFS использует более сложные и эффективные методы индексации, например B-деревья или B+-деревья, чтобы организовать и отслеживать файлы и каталоги на диске. Это позволяет более быстрый и эффективный поиск файлов по имени, пути или другим свойствам, по сравнению с линейным поиском в FAT.  
      
2. **Кэширование метаданных**: NTFS активно использует кэширование метаданных, таких как информация о файле, права доступа и время модификации. Это позволяет ускорить чтение и запись операций, так как не всегда требуется обращение к диску для получения актуальной информации.  
      
3. **Оптимизированное размещение данных на диске**: NTFS осуществляет оптимизированное размещение данных на диске, используя концепцию фрагментации. Файлы хранятся в виде последовательных блоков на диске, а не разбиваются на более мелкие фрагменты, как в случае с FAT. Это уменьшает фрагментацию диска и улучшает скорость чтения и записи файлов.  
      
4. **Поддержка журналирования**: NTFS оснащен системой журналирования, которая записывает все изменения на диске в журнал перед выполнением фактической операции. Это позволяет восстановить целостность файловой системы после сбоев или аварийного выключения компьютера. Журналирование также помогает ускорить операции записи, так как они могут быть отложены до более оптимального времени.  
      
5. **Размер кластера и распределение пространства**: В NTFS можно выбрать более эффективный размер кластера по сравнению с FAT, чтобы уменьшить фрагментацию и повысить производительность доступа к файлам. NTFS также лучше управляет свободным пространством на диске, что позволяет избежать фрагментации и обеспечивает быстрый доступ к нему.  
      

В целом, NTFS обладает более развитыми и оптимизированными функциями для ускорения доступа к файлам по сравнению с простой структурой FAT. Эти улучшения помогают повысить производительность и эффективность работы с файлами в NTFS.  